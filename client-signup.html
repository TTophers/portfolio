<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SignUp | Client</title>
  <style>
    :root {
      --bg: #0f1115;
      --panel: #151922;
      --accent: #4f8cff;
      --text: #e6e8ee;
      --muted: #9aa0b3;
      --border: #23283a;
    }

    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
    }

    nav {
      height: 60px;
      display: flex;
      align-items: center;
      padding: 0 24px;
      border-bottom: 1px solid var(--border);
      background: var(--panel);
    }

    nav .logo {
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .login-card {
      width: 100%;
      max-width: 380px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 28px;
    }

    .login-card h1 {
      margin: 0 0 8px 0;
      font-size: 22px;
    }

    .login-card p {
      margin: 0 0 24px 0;
      color: var(--muted);
      font-size: 14px;
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
      color: var(--muted);
    }

    input, select {
      width: 100%;
      padding: 12px;
      margin-bottom: 16px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: #0b0e14;
      color: var(--text);
      font-size: 14px;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
    }

    button {
      width: 100%;
      padding: 12px;
      border-radius: 6px;
      border: none;
      background: var(--accent);
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    button:hover {
      opacity: 0.9;
    }

    .footer-text {
      margin-top: 16px;
      font-size: 12px;
      color: var(--muted);
      text-align: center;
    }

    .signin-link {
      margin-top: 16px;
      font-size: 13px;
      color: var(--accent);
      text-align: center;
      cursor: pointer;
      text-decoration: underline;
      background: none;
      border: none;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    .website-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }

    .website-buttons button {
      flex: 1;
      background: var(--panel);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 12px 0;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }

    .website-buttons button.selected {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }
  </style>
</head>
<body>
  <nav>
    <div class="logo">Client SignUp</div>
  </nav>

  <main>
    <div class="login-card">
      <h1>Sign Up</h1>

      <form id="loginForm">
        <label for="fullname">Full Name</label>
        <input type="text" id="fullname" required />

        <label for="email">Email Address</label>
        <input type="email" id="email" required />

        <label for="password">Password</label>
        <input type="password" id="password" required />

        <label>Do you already have a website?</label>
        <div class="website-buttons">
          <button type="button" data-value="yes">Yes</button>
          <button type="button" data-value="no">No</button>
        </div>
        <input type="hidden" id="website" name="website" required />
        
        <div id="formError" style="color:red; margin-bottom: 12px;"></div>

        <button type="submit">Sign Up</button>
      </form>

      <div id="processingMessage" style="color: var(--accent); margin-top: 8px; display: none;">Processing...</div>

      <button class="signin-link" type="button" onclick="window.location.href='client-loggin.html'">Already have an account? Sign In</button>

      <div class="footer-text">Protected system</div>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCmACuB6COC6welNT7uN5aX4BXYVL-OEF8",
      authDomain: "tophers-design.firebaseapp.com",
      projectId: "tophers-design",
      storageBucket: "tophers-design.firebasestorage.app",
      messagingSenderId: "163525514090",
      appId: "1:163525514090:web:180497723fe8b8f5694b13"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Set Firebase Auth persistence to browserLocalPersistence
    setPersistence(auth, browserLocalPersistence).catch((err) => {
      // If persistence setting fails, show inline error
      const formError = document.getElementById('formError');
      formError.textContent = "Failed to set authentication persistence: " + err.message;
    });

    // Website buttons toggle logic
    const websiteButtons = document.querySelectorAll('.website-buttons button');
    const websiteInput = document.getElementById('website');
    const formError = document.getElementById('formError');
    const processingMessage = document.getElementById('processingMessage');

    websiteButtons.forEach(button => {
      button.addEventListener('click', () => {
        websiteButtons.forEach(btn => btn.classList.remove('selected'));
        button.classList.add('selected');
        websiteInput.value = button.getAttribute('data-value');
      });
    });

    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      formError.textContent = "";
      processingMessage.style.display = "none";

      const fullName = document.getElementById("fullname").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const websiteValue = websiteInput.value; // "yes" or "no"

      // Validation
      if (!fullName) {
        formError.textContent = "Full Name is required.";
        return;
      }

      // Basic email pattern validation
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email || !emailPattern.test(email)) {
        formError.textContent = "Please enter a valid email address.";
        return;
      }

      if (!password || password.length < 6) {
        formError.textContent = "Password must be at least 6 characters.";
        return;
      }

      if (!websiteValue) {
        formError.textContent = "Please select if you already have a website.";
        return;
      }

      processingMessage.style.display = "block";

      try {
        // Create user
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        const hasWebsite = websiteValue === "yes";

        // Write Firestore
        await setDoc(doc(db, "users", user.uid), {
          role: "client",
          name: fullName,
          email,
          hasWebsite,
          createdAt: serverTimestamp()
        });

        // Redirect to onboarding page
        window.location.replace("client-onboarding.html");
      } catch (err) {
        console.error("Signup / Firestore error:", err);
        formError.textContent = err.message;
      } finally {
        // Only hide processing message if not redirecting
        setTimeout(() => {
          processingMessage.style.display = "none";
        }, 300);
      }
    });
  </script>
</body>
</html>